/*
===============================================================================
Data Quality Checks for Silver Layer (MySQL)
===============================================================================
Run this after ETL loads the Silver schema.
===============================================================================
*/

USE silver;

-- ====================================================================
-- CRM CUSTOMER INFO
-- ====================================================================

-- Nulls or Duplicates in Primary Key
SELECT 
    cst_id,
    COUNT(*) AS cnt
FROM crm_cust_info
GROUP BY cst_id
HAVING COUNT(*) > 1 OR cst_id IS NULL;

-- Unwanted Spaces
SELECT 
    cst_key
FROM crm_cust_info
WHERE cst_key <> TRIM(cst_key);

-- Standardization / Consistency
SELECT DISTINCT 
    cst_marital_status
FROM crm_cust_info;

-- ====================================================================
-- CRM PRODUCT INFO
-- ====================================================================

-- Nulls or Duplicates in Primary Key
SELECT 
    prd_id,
    COUNT(*) AS cnt
FROM crm_prd_info
GROUP BY prd_id
HAVING COUNT(*) > 1 OR prd_id IS NULL;

-- Unwanted Spaces
SELECT 
    prd_nm
FROM crm_prd_info
WHERE prd_nm <> TRIM(prd_nm);

-- Null or Negative Product Costs
SELECT 
    prd_id,
    prd_cost
FROM crm_prd_info
WHERE prd_cost < 0 OR prd_cost IS NULL;

-- Product Line Standardization
SELECT DISTINCT 
    prd_line
FROM crm_prd_info;

-- Invalid Date Orders
SELECT 
    *
FROM crm_prd_info
WHERE prd_end_dt < prd_start_dt;

-- ====================================================================
-- CRM SALES DETAILS
-- ====================================================================

-- Invalid Source Dates (Bronze check style)
SELECT 
    sls_due_dt
FROM bronze.crm_sales_details
WHERE sls_due_dt IS NULL
   OR sls_due_dt = 0
   OR LENGTH(sls_due_dt) != 8
   OR sls_due_dt > 20500101
   OR sls_due_dt < 19000101;

-- Invalid Order / Shipping / Due Date Sequence
SELECT 
    *
FROM crm_sales_details
WHERE (sls_order_dt > sls_ship_dt AND sls_ship_dt IS NOT NULL)
   OR (sls_order_dt > sls_due_dt  AND sls_due_dt  IS NOT NULL);

-- Sales Consistency
SELECT 
    sls_ord_num,
    sls_sales,
    sls_quantity,
    sls_price
FROM crm_sales_details
WHERE sls_sales IS NULL
   OR sls_quantity IS NULL
   OR sls_price IS NULL
   OR sls_sales <= 0
   OR sls_quantity <= 0
   OR sls_price <= 0
   OR sls_sales <> (sls_quantity * sls_price)
ORDER BY sls_sales, sls_quantity, sls_price;

-- ====================================================================
-- ERP CUSTOMER (AZ12)
-- ====================================================================

-- Out-of-range Birthdates
SELECT DISTINCT 
    bdate
FROM erp_cust_az12
WHERE bdate < '1924-01-01'
   OR bdate > CURRENT_DATE();

-- Gender Standardization
SELECT DISTINCT 
    gen
FROM erp_cust_az12;

-- ====================================================================
-- ERP LOCATION (A101)
-- ====================================================================

-- Country Standardization
SELECT DISTINCT 
    cntry
FROM erp_loc_a101
ORDER BY cntry;

-- ====================================================================
-- ERP PRODUCT CATEGORY (G1V2)
-- ====================================================================

-- Unwanted Spaces
SELECT 
    *
FROM erp_px_cat_g1v2
WHERE cat <> TRIM(cat)
   OR subcat <> TRIM(subcat)
   OR maintenance <> TRIM(maintenance);

-- Maintenance Standardization
SELECT DISTINCT 
    maintenance
FROM erp_px_cat_g1v2;
